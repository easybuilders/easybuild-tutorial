
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://easybuilders.github.io/easybuild-tutorial/2022-isc22/integration_lumi/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Integration of EasyBuild in LUMI - EasyBuild tutorial</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integration-of-easybuild-in-lumi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="EasyBuild tutorial" class="md-header__button md-logo" aria-label="EasyBuild tutorial" data-md-component="logo">
      
  <img src="../../img/easybuild_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EasyBuild tutorial
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Integration of EasyBuild in LUMI
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/easybuilders" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EasyBuild @ GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="EasyBuild tutorial" class="md-nav__button md-logo" aria-label="EasyBuild tutorial" data-md-component="logo">
      
  <img src="../../img/easybuild_logo.png" alt="logo">

    </a>
    EasyBuild tutorial
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/easybuilders" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EasyBuild @ GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          ISC'22 (29 May 2022)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ISC'22 (29 May 2022)" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ISC'22 (29 May 2022)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        (overview)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../practical_info/" class="md-nav__link">
        Practical info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terminology/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic_usage/" class="md-nav__link">
        Basic usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installing_software/" class="md-nav__link">
        Installing software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../adding_support_additional_software/" class="md-nav__link">
        Support for additional software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../module_naming_schemes/" class="md-nav__link">
        Module naming schemes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integration_jsc/" class="md-nav__link">
        Integration of EasyBuild in JSC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integration_eessi/" class="md-nav__link">
        Integration of EasyBuild in EESSI
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Integration of EasyBuild in LUMI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Integration of EasyBuild in LUMI
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-information" class="md-nav__link">
    General information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenges" class="md-nav__link">
    Challenges
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-with-easybuild-and-lmod" class="md-nav__link">
    Solution with EasyBuild and Lmod
  </a>
  
    <nav class="md-nav" aria-label="Solution with EasyBuild and Lmod">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#software-stacks" class="md-nav__link">
    Software stacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easybuild-for-software-management" class="md-nav__link">
    EasyBuild for software management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offering-easybuild-in-the-lumi-stacks" class="md-nav__link">
    Offering EasyBuild in the LUMI stacks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#easybuild-on-lumi" class="md-nav__link">
    EasyBuild on LUMI
  </a>
  
    <nav class="md-nav" aria-label="EasyBuild on LUMI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-toolchains" class="md-nav__link">
    Custom toolchains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-modules" class="md-nav__link">
    External modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software-specific-easyblocks" class="md-nav__link">
    Software-specific easyblocks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-lumi-specific-easybuild-settings" class="md-nav__link">
    Other LUMI-specific EasyBuild settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading-and-information" class="md-nav__link">
    Further reading and information
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../community/" class="md-nav__link">
        The EasyBuild community
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing to EasyBuild
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_other_tools/" class="md-nav__link">
        Comparison with other tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Archive
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Archive" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Archive
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          ISC'21 (25 June 2021)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ISC'21 (25 June 2021)" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          ISC'21 (25 June 2021)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/" class="md-nav__link">
        (overview)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/practical_info/" class="md-nav__link">
        Practical info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/terminology/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/basic_usage/" class="md-nav__link">
        Basic usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/installing_software/" class="md-nav__link">
        Installing software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/module_naming_schemes/" class="md-nav__link">
        Module naming schemes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/adding_support_additional_software/" class="md-nav__link">
        Support for additional software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/jsc/" class="md-nav__link">
        EasyBuild at JSC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/computecanada/" class="md-nav__link">
        EasyBuild at Compute Canada
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/community/" class="md-nav__link">
        The EasyBuild community
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-isc21/contributing/" class="md-nav__link">
        Contributing to EasyBuild
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          LUST (spring '21)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="LUST (spring '21)" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          LUST (spring '21)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/" class="md-nav__link">
        (overview)
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2" type="checkbox" id="__nav_3_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_2">
          Introduction to EasyBuild
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction to EasyBuild" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_2">
          <span class="md-nav__icon md-icon"></span>
          Introduction to EasyBuild
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/part1_intro/" class="md-nav__link">
        (overview)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/what_is_easybuild/" class="md-nav__link">
        What is EasyBuild?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/terminology/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/basic_usage/" class="md-nav__link">
        Basic usage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3" type="checkbox" id="__nav_3_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_3">
          Using EasyBuild
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Using EasyBuild" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_3">
          <span class="md-nav__icon md-icon"></span>
          Using EasyBuild
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/part2_using/" class="md-nav__link">
        (overview)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/creating_easyconfig_files/" class="md-nav__link">
        Creating easyconfig files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/implementing_easyblocks/" class="md-nav__link">
        Implementing easyblocks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_4" type="checkbox" id="__nav_3_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_4">
          Advanced topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced topics" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_4">
          <span class="md-nav__icon md-icon"></span>
          Advanced topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/part3_advanced/" class="md-nav__link">
        (overview)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/easybuild_library/" class="md-nav__link">
        Using EasyBuild as a library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/hooks/" class="md-nav__link">
        Using hooks to customise EasyBuild
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/slurm_jobs/" class="md-nav__link">
        Submitting installations as Slurm jobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/module_naming_schemes/" class="md-nav__link">
        Module naming schemes (incl. hierarchical)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/github_integration/" class="md-nav__link">
        GitHub integration to facilitate contributing to EasyBuild
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_5" type="checkbox" id="__nav_3_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_5">
          EasyBuild on Cray systems
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="EasyBuild on Cray systems" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_5">
          <span class="md-nav__icon md-icon"></span>
          EasyBuild on Cray systems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/part4_cray/" class="md-nav__link">
        (overview)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/cray/introduction/" class="md-nav__link">
        Introduction to the Cray PE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/cray/external_modules/" class="md-nav__link">
        Using external modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/cray/custom_toolchains/" class="md-nav__link">
        Custom Cray toolchains
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2021-lust/cray/easybuild_at_cscs/" class="md-nav__link">
        EasyBuild at CSCS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          ISC'20 (June '20)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ISC'20 (June '20)" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          ISC'20 (June '20)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/" class="md-nav__link">
        Start page
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/practical_information/" class="md-nav__link">
        Practical information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/basic_usage/" class="md-nav__link">
        Basic usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/hmns/" class="md-nav__link">
        Hierarchical module naming schemes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/adding_support_software/" class="md-nav__link">
        Adding support for additional software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/jsc/" class="md-nav__link">
        EasyBuild at Jülich Supercomputing Centre
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/computecanada/" class="md-nav__link">
        EasyBuild at Compute Canada
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/community/" class="md-nav__link">
        The EasyBuild community
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/contributing/" class="md-nav__link">
        Contributing to EasyBuild
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/comparison_other_tools/" class="md-nav__link">
        Comparison with other tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../2020-06-isc20/getting_help/" class="md-nav__link">
        Getting help
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-information" class="md-nav__link">
    General information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenges" class="md-nav__link">
    Challenges
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-with-easybuild-and-lmod" class="md-nav__link">
    Solution with EasyBuild and Lmod
  </a>
  
    <nav class="md-nav" aria-label="Solution with EasyBuild and Lmod">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#software-stacks" class="md-nav__link">
    Software stacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easybuild-for-software-management" class="md-nav__link">
    EasyBuild for software management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offering-easybuild-in-the-lumi-stacks" class="md-nav__link">
    Offering EasyBuild in the LUMI stacks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#easybuild-on-lumi" class="md-nav__link">
    EasyBuild on LUMI
  </a>
  
    <nav class="md-nav" aria-label="EasyBuild on LUMI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-toolchains" class="md-nav__link">
    Custom toolchains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-modules" class="md-nav__link">
    External modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software-specific-easyblocks" class="md-nav__link">
    Software-specific easyblocks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-lumi-specific-easybuild-settings" class="md-nav__link">
    Other LUMI-specific EasyBuild settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading-and-information" class="md-nav__link">
    Further reading and information
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/easybuilders/easybuild-tutorial/edit/main/docs/2022-isc22/integration_lumi.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="integration-of-easybuild-in-lumi">Integration of EasyBuild in LUMI<a class="headerlink" href="#integration-of-easybuild-in-lumi" title="Permanent link">&para;</a></h1>
<h2 id="general-information">General information<a class="headerlink" href="#general-information" title="Permanent link">&para;</a></h2>
<p><a href="https://www.lumi-supercomputer.eu/">LUMI</a>, installed in a CSC data centre (Finland)), is one of the three planned 
<a href="https://eurohpc-ju.europa.eu/discover-eurohpc-ju#ecl-inpage-211">EuroHPC pre-exascale systems</a> 
meant to be installed in 2022-2023, 
together with Leonardo (installed at Cineca) and MareNostrum5 (installed at BSC).
LUMI, which stands for <em>Large Unified Modern Infrastructure</em>, is hosted by the
<a href="https://www.lumi-supercomputer.eu/lumi-consortium/">LUMI consortium</a>,
a consortium of 10 countries: Finland, Belgium, Czech Republic, Denmark, Estonia, Iceland, 
Norway, Poland, Sweden, and Switzerland. It was supposed to be installed by the end of 2021,
but the global shortage of components and some technical problems have delayed the installation.
The final hardware should be installed before mid 2022.</p>
<p><a href="https://www.lumi-supercomputer.eu/may-we-introduce-lumi/">
<img src="../../img/lumi-snowflake.png" style="float:right" width="100%"/>
</a></p>

<p>LUMI is an <strong>HPE Cray EX supercomputer</strong> with several partitions targeted for different use cases.
It is also possible to run heterogeneous jobs across multiple partitions.</p>
<ul>
<li>
<p>The main compute power is provided by the <em>LUMI-G</em> GPU compute partition consisting of 2,560 nodes.
    The LUMI-G node is a revolutionary compute node in the x86+GPU-world. 
    It is also truly a "GPU first" system.</p>
<p>Each GPU compute node has a single 64 core AMD EPYC 7A53 "Trento" CPU and 4 MI250X GPUs. 
Each MI250X package contains two GPU compute dies connected to each other via AMD's InfinityFabric
interconnect and 8 HBM2e memory stacks, 4 per die. The GPUs and CPU are all connected through
AMD's InfinityFabric interconnect, creating a cache coherent unified memory space in each node.
The Trento CPU is a Zen3 generation product but with an optimised I/O die that can run the
InfinityFabric interconnect at a higher speed than standard Milan CPUs.</p>
<p>Each node also has 4 200Gbit/s SlingShot 11 interconnect cards, each connected directly to 
a different GPU package. Each node has 512GB HBM2e RAM spread evenly across the GPU dies and 
512 GB of regular DDR4 DRAM connected to the CPU. The nodes are diskless nodes.
The (very) theoretical peak performance of a GPU node is
around 200 Tflops for FP64 vector operations or 400 TFlops for FP64 matrix operations.</p>
</li>
<li>
<p>The main CPU partition, called <em>LUMI-C</em>, consists of 1,536 nodes with two 64-core AMD
    EPYC 7,763 CPUs. Most nodes have 256 GB of RAM memory, but there are 128 nodes with
    512 GB of RAM and 32 nodes with 1 TB of RAM. In the final system, each node will be equipped
    with one 200 Gbit/s SlingShot 11 interconnect card. These nodes are diskless nodes.</p>
</li>
<li>
<p>A section mostly meant for interactive data analysis consists of 8 nodes with two 64-core
    AMD EPYC 7742 CPUs and 4 TB of RAM per node. These nodes are connected to the interconnect
    through two 100 Gbit/s SlingShot 10 links.</p>
</li>
<li>
<p>The second part of <em>LUMI-D</em>, the data visualisation section, consists of 8 nodes with two
    64-core AMD EPYC 7742 CPUs and 8 NVIDIA A40 GPUs each. Each node has 2 TB of RAM and is
    connected to the interconnect through two 100 Gbit/s SlingShot 10 links.</p>
</li>
<li>
<p><em>LUMI-K</em> will be an OpenShift/Kubernetes container cloud platform for running microservices
    with roughly 50 nodes.</p>
</li>
<li>
<p>LUMI also has an extensive storage system</p>
<ul>
<li>There is a 7 PB flash-based storage system with 2 TB/s of bandwidth and high IOPS
    capability using the Lustre parallel file system and Cray ClusterStor E1000 technology.</li>
<li>The main disk based storage contains of four 20 PB storage systems based on regular hard
    disks and also using the Lustre parallel file system.</li>
<li>A 30 PB Ceph-based encrypted object storage system for storing, sharing and staging data
    will become available at a later date.</li>
</ul>
</li>
</ul>
<h2 id="challenges">Challenges<a class="headerlink" href="#challenges" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>LUMI comes with the <em>HPE Cray Programming Environment (PE)</em> with the Cray Compiling Environment
    (a fully Clang/LLVM-based C/C++ compiler and a Fortran compiler using a Cray frontend but
    LLVM-based backend) and GNU and AMD compilers repackaged by Cray. The HPE Cray PE uses
    an MPICH-based MPI implementation (with libfabric backend on SlingShot 11) and also comes 
    with its own optimised mathematics libraries containing all the usual suspects you expect 
    from an EasyBuild toolchain. The HPE Cray PE environment is managed outside EasyBuild, but
    EasyBuild has a mechanism to integrate with it.</p>
<p>Due to the specific hardware and software setup of LUMI using the <a href="https://docs.easybuild.io/en/latest/Common-toolchains.html">EasyBuild common
toolchains</a>
is anything but straightforward. Getting Open MPI, a key component of the foss toolchain, to work 
is a bit of a challenge at the moment. The Intel compilers are not a very good match with 
AMD CPUs. One needs to be very careful when choosing the target architecture for code
optimisation (<code>-xHost</code> will not generate AVX/AVX2 code), most recent versions of MKL have
performance problems and sometimes produce wrong results and some recent MPI versions also
cause problems with AMD CPUs.</p>
</li>
<li>
<p>LUMI has only a <em>small central support team of 9 FTE</em>. It is obvious that we cannot give the same
    level of support for software installations as some of the big sites such as JSC can do. Moreover,
    due to the nature of the LUMI environment with its Cray PE and novel AMD GPUs, installing software
    is more challenging than on your typical Intel + NVIDIA GPU cluster with NVIDIA/Mellanox
    interconnect. Given that the technology is very new, one can also expect a rapid evolution of
    the programming environment with a risk of breaking compatibility with earlier versions,
    and a need for frequent software updates in the initial years of operation to work around bugs
    or make new and important features available. So the maintenance cost of a the user application
    stack is certainly higher than on clusters based on more conventional technology. Early experience
    has also shown that we need to be prepared for potentially breaking changes on very short notice.</p>
<p>It also means that we have to be very agile when it comes to maintaining the software stack and
that it is also impossible to thoroughly test all installations, so we must be able to make
corrections quickly. This goes against a big central software stack, as in a central software
stack it is nearly impossible to replace an installation that fails for some users outside
maintenance intervals.</p>
</li>
<li>
<p>The central support team may be small (the above 9 FTE), but the 
    LUMI consortium agreement states that the 
    consortium countries also have to assist in providing support. Given that neither the 
    LUMI User Support Team members nor the local support teams are employees of CSC this 
    also means that much of the application support has to be delivered with very little
    rights on the system (at most a working directory that is readable for all users and writable for
    support people). So we 
    need a setup where it is possible to help users installing applications while having
    only regular user rights on the system.</p>
</li>
<li>
<p>Due to the exploitation model and the small size of the central support team, license management
    is a pain. Users come to LUMI through 11 different channels (some with subchannels). Moreover it
    is the responsibility of the PI to invite users to a project and to ensure that they are eligible
    for LUMI use (taking into account, e.g., the European and USA export restrictions). At the central
    level we have no means to check who can use which software license. Hence we need a
    solution to distribute that responsibility also.</p>
</li>
<li>
<p>LUMI software support is based on the idea that users really want a customised software stack. They may say they want 
    a central stack but only as long as it contains the software they need and not much more as they 
    also do not want to search through long lists of modules. Nobody is waiting for 20 different
    configurations of a package, but the reality is that different users will want different versions
    with sometimes conflicting configurations, or compiled with different compilers. </p>
<p>We also note that some communities forego centrally installed software which may have better
optimised binaries to build their own custom setup using tools such as Conda. </p>
<p>And even though modules go a long way in managing dependencies and helping to avoid conflicts,
we expect that with the explosion of software used on HPC machines and the poor maintenance of that
software, it will become increasingly difficult to find versions of dependencies that work for 
a range of programs, leading to cases where we may simply need to install a software package
with different sets of dependencies simply because users want to use it together with other 
packages that have restrictions on the versions of those dependencies. Experienced Python users
without doubt know what a mess this can create and how even a single user sometimes needs
different virtual environments with different installations to do their work.</p>
</li>
</ul>
<h2 id="solution-with-easybuild-and-lmod">Solution with EasyBuild and Lmod<a class="headerlink" href="#solution-with-easybuild-and-lmod" title="Permanent link">&para;</a></h2>
<p><a href="https://lumi-supercomputer.eu/easybuild-lumis-primary-software-installation-tool-introduced/">On LUMI we selected EasyBuild as our primary software installation
tool</a>,
but also offer some limited
support for Spack. EasyBuild was selected as there is already a lot of experience with EasyBuild in
several of the LUMI consortium countries, and as it is a good fit with the goals of the EuroHPC JU
as they want to establish a European HPC ecosystem with a European technology option at every level.
The developers of EasyBuild are also very accessible and it helps that the lead developer and several
of the maintainers are from LUMI consortium countries.</p>
<p>We use <a href="https://lmod.readthedocs.io/en/latest/">Lmod</a> as the module tool. 
We basically had the choice between Lmod and the old C implementation
of TCL Environment Modules as HPE Cray does not support the more modern 
<a href="http://modules.sourceforge.net/">Environment Modules 4 or 5</a>
developed in France. Support for Lmod is excellent in EasyBuild and Spack, and Lua is also
a more modern language to work with than TCL.</p>
<h3 id="software-stacks">Software stacks<a class="headerlink" href="#software-stacks" title="Permanent link">&para;</a></h3>
<p>On LUMI we offer users the choice between multiple software stacks, offered through hand-written
Lmod modules.</p>
<ul>
<li>
<p>The <strong>CrayEnv</strong> stack is really just a small layer on top of the HPE Cray PE in which we provide
    a few additional tools and help the user with managing the environment for the HPE Cray PE.</p>
<p>The HPE Cray PE works with a universal compiler wrapper that sets some optimisation options for
the supported compilers and sets the flags to compile and link with the MPI, optimised scientific
libraries and some other libraries provided with the PE. It does so based on which modules are
loaded. The CPU and GPU targets and the MPI fabric library are selected through so-called
target modules, typically loaded during shell initialisation, while compiler, MPI and
scientific libraries are typically loaded through the so-called <code>PrgEnv-*</code>  modules (one for each
supported compiler). The CrayEnv software stack module will take care of ensuring that a proper
set of target modules is loaded depending on the node type on which the module is loaded, and 
also ensure that the proper set of target modules is reloaded after a <code>module purge</code>. </p>
<p>The environment is also enriched with a number of build tools that are not installed in the OS image
or only in an older version. These tools are often build with EasyBuild with the <code>SYSTEM</code> toolchain
though we do not make EasyBuild itself available to users in that stack.</p>
</li>
<li>
<p>The <strong>LUMI</strong> stack is a software stack which is mostly managed with EasyBuild. The stack is versioned
    based on the version of the HPE Cray PE which makes it easy to retire a whole stack when the compilers
    are retired from the system. If we need the same software in two different stacks, it is simply compiled
    twice, even if it is only installed with the system compilers, to make retiring software easier without
    having to track dependencies (we now simply have to remove a few directories to remove a whole
    software stack which will not have an impact on the other stacks). The
    exception are a few packages installed from binaries that are installed in a separate area and available across all
    software stacks (e.g., ARM Forge and Vampir). The LUMI stack provides optimised binaries for each node
    type of LUMI, but some software that is not performance-critical is compiled only once. To this end we 
    have a partition corresponding to each node type, but also a common partition which is included with 
    the software of all other partitions. Software in that common partition can only have dependencies 
    in the common partition though.</p>
<p>For now we keep the central LUMI software stack very small, but we provide an easy and fully transparent
mechanism for the user to install software in their project directory that integrates fully with the LUMI
stack. The user only needs to set an environment variable pointing to the project space.</p>
</li>
</ul>
<p>In the future we envision that more software stacks may become available on LUMI as at least one local support
organisation wants to build their own stack. We also hope to find a solution
to get the foss toolchain working on at least the CPU nodes of LUMI with minimal changes
in a future collaboration with HPE.</p>
<h3 id="easybuild-for-software-management">EasyBuild for software management<a class="headerlink" href="#easybuild-for-software-management" title="Permanent link">&para;</a></h3>
<p>The second component to our solution is EasyBuild. EasyBuild can give a very precise description of
all the steps needed to build a package while the user needs to give very few arguments to the <code>eb</code> command
to actually do the installation. It is also robust enough that with a proper module to configure EasyBuild,
an installation done by one user on LUMI will reproduce easily in the environment of another user. 
The fact that each easyconfig file contains a very precise list of dependencies, including versions and
not only the names of the dependencies, is both a curse and a blessing. It is a curse when we need to upgrade
to a new compiler and also want to upgrade versions of certain dependencies, as a lot of easyconfig files need
to be checked and edited. In those cases the automatic concretiser of Spack may help to get running quicker.</p>
<p>However, that very precise description is also a blessing when communicating with users as you can
communicate with them through EasyBuild recipes (and possibly an easystack file, which defines a list of 
easyconfig files to install) rather than having a part of the specification in command line options of the
tool. So a user doesn't need to copy long command lines and as a support person
you know exactly what EasyBuild will do, so this leaves less room for errors and difficult to solve support
tickets. (Though note that with Spack environments you can also give a full specification in an Environment
manifest.)</p>
<h3 id="offering-easybuild-in-the-lumi-stacks">Offering EasyBuild in the LUMI stacks<a class="headerlink" href="#offering-easybuild-in-the-lumi-stacks" title="Permanent link">&para;</a></h3>
<p>The LUMI software stack is implemented as an Lmod hierarchy with two levels. On top of it EasyBuild is used
with a flat naming scheme (though we did consider a hierarchical one as well).</p>
<p>The modules that load a specific version of the software stack are hand-written in Lua. The first level
(a module called <code>LUMI</code>) is the version of the software stack, 
the second level (a module called <code>partition</code>) then choses the particular set of hardware to
optimise for. The <code>LUMI</code> module will autoload the most suited <code>partition</code> module for the hardware,
but users can overwrite this choice, e.g., for cross-compiling which is a common practice on
HPE Cray systems but not without difficulties and hence not always possible.</p>
<p>The <code>LUMI</code> and <code>partition</code> module combo also check a default location for the user software stack, and
an environment variable that is used to point to a different location for the user software stack. 
If a user software stack is found, its modules are automatically added to the stack. There are also
some <code>partition</code> modules that do not correspond to particular hardware but are only used during software
installation, to install software in "special" locations. E.g., the module <code>partition/common</code> is used to
install some software for all partitions without binaries optimised specifically for each partition. 
On LUMI, a selection of build and version control tools is currently installed that way.</p>
<p>The <code>LUMI</code> and <code>partition</code> modules are both implemented in a generic way. Instances in the module tree are
symbolic links to the generic implementations, and so-called Lmod introspection functions are used by
the modules to determine their function from the location in the module tree. This makes it easy to correct
bugs and extend the module files without having to go over different implementations in different locations.</p>
<p>To enable all this functionality, including the common partition, a double module structure was needed
to ensure the proper working of the Lmod hierarchy. The infrastructure tree is implemented following
all proper rules for an Lmod hierarchy. It houses the <code>LUMI</code> and <code>partition</code> modules among others, but
also the toolchain modules so that they can be configured specifically for each version of the <code>LUMI</code> 
software stack and <code>partition</code>. The software module tree contains all software installed through 
EasyBuild, with room to expand to manually installed software or software installed with Spack
should this turn out to be necessary and safe to combine with EasyBuild-managed software.</p>
<p>EasyBuild is configured through some configuration modules that set a range of <code>EASYBUILD_*</code> variables
to configure EasyBuild. There is again only a single EasyBuild configuration module implemented in Lua,
but it appears with three different names in multiple locations in the infrastructure module tree, 
and again Lmod introspection functions are used by the module to determine its specific function. 
There are three configurations for EasyBuild: One for installation in the infrastructure module tree,
one for installation in the main software tree and one for installation in the user software tree.
By using just a single implementation for all three functions, we ensure that the different configurations
remains consistent. This is important, e.g., to guarantee that the user configuration builds correctly
upon the centrally installed stack, so any change to the structure of the latter should also propagate
to the configuration of the former.</p>
<h2 id="easybuild-on-lumi">EasyBuild on LUMI<a class="headerlink" href="#easybuild-on-lumi" title="Permanent link">&para;</a></h2>
<h3 id="custom-toolchains">Custom toolchains<a class="headerlink" href="#custom-toolchains" title="Permanent link">&para;</a></h3>
<p>The LUMI EasyBuild solution is not based on the common toolchains as the HPE Cray Programming Environment
is the primary development environment on LUMI for which we also obtain support from HPE and as the common
toolchains both post problems on LUMI. So far we have not yet succeeded to ensure proper operation of 
Open MPI on LUMI which is a showstopper for working with the FOSS toolchain hierarchy. There is also no support
yet for AMD GPUs in the common toolchains. Moreover, the FOSS toolchain is becoming a very powerful vehicle
by the inclusion of FlexiBLAS and now also efforts to build an Open MPI configuration that supports both
CPU nodes and NVIDIA GPU nodes but the downside of this is that it has also become a very complicated 
setup to adapt if you need something else, as we do on LUMI. The Intel toolchain also has its problems. 
Intel does not support oneAPI on AMD processors. Though Intel MPI can in principle run on SlingShot as it is
also based on libfabric and will be used on Aurora, a USA exascale system build by Intel with HPE Cray
as a subcontractor for the hardware, users of AMD systems have reported problems with recent versions.
MKL does not only have performance problems, but several sources also report correctness problem,
especially in computational chemistry DFT codes.</p>
<p>Instead we employ toolchains specific for the three (soon four) versions of the HPE Cray Programming
Environment: HPE Cray's own Cray Compiler Environment compilers with a C/C++ compiler based on Clang/LLVM
with some vendor-specific plugins and a Fortran compiler that compiles HPE Cray's frontend with a backend
based on LLVM, the GNU Compiler Collection with its C/C++ and Fortran compiler, the AMD Optimizing
C/C++ and Fortran Compilers (AOCC) and soon also a version employing the AMD ROCm compilers for the 
AMD GPU compute nodes. The toolchains used on LUMI are a further evolution of the toolchains used
at CSCS with many bug corrections in the AOCC-based toolchain and better support for toolchain options
specified through <code>toolchainopts</code>. They should however be largely compatible with the EasyConfigs
in the <a href="https://github.com/eth-cscs/production">CSCS repository</a>.</p>
<p>The toolchains are loaded through modules, generated with EasyBuild and a custom EasyBlock, that replace
the top <code>PrgEnv</code> modules from the HPE Cray Programming Environment. These modules then use the modules provided
by HPE Cray to load the actual compilers, compiler wrappers, MPI libraries and scientific libraries, and
the target modules that determine how the main modules work. So contrary to many other EasyBuild toolchains,
the compilers, MPI and scientific libraries are not installed through EasyBuild.</p>
<h3 id="external-modules">External modules<a class="headerlink" href="#external-modules" title="Permanent link">&para;</a></h3>
<p>EasyBuild supports the use of modules that were not installed via EasyBuild. 
We refer to such modules as <a href="https://docs.easybuild.io/en/latest/Using_external_modules.html">external modules</a>.
External modules do not define the <code>EBROOT*</code> and <code>EBVERSION*</code> environment variables that are present
in EasyBuild-generated modules and that EasyBuild uses internally in some easyblocks and easyconfigs, 
and they also have no corresponding easyconfig file that can tell EasyBuild about further dependencies.</p>
<p>External modules are used extensively on Cray systems to interface with the Cray PE (which comes with its own
modules and cannot be installed via EasyBuild):
<a href="https://docs.easybuild.io/en/latest/Using_external_modules.html#using-external-modules-as-dependencies">external modules can be used as dependencies</a>, 
by including the module name in the dependencies list, 
along with the <code>EXTERNAL_MODULE</code> constant marker.</p>
<p>As an example, the Cray PE contains its own FFTW module, called <code>cray-fftw</code>.
To use this module as a dependency, you should write the following in your easyconfig file:
<div class="highlight"><pre><span></span><code><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;cray-fftw&#39;</span><span class="p">,</span> <span class="n">EXTERNAL_MODULE</span><span class="p">)]</span>
</code></pre></div>
(for the default version).</p>
<p>For such dependencies, EasyBuild will:</p>
<ul>
<li>
<p>load the module before initiating the software build and install procedure</p>
</li>
<li>
<p>include a <code>module load</code> statement in the generated module file (for runtime dependencies)</p>
</li>
<li>
<p>but it will not go looking for a matching easyconfig file.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default version of the external module will be loaded unless a specific version is given as dependency,
and here that version needs to be given as part of the name of the module and not as the second element in the
tuple.</p>
<div class="highlight"><pre><span></span><code><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;cray-fftw/3.3.8.12&#39;</span><span class="p">,</span> <span class="n">EXTERNAL_MODULE</span><span class="p">)]</span>
</code></pre></div>
</div>
<p>If the specified module is not available, EasyBuild will exit with an error message stating that the dependency 
can not be resolved because the module could not be found, without searching for a matching easyconfig file
from which it could generate the module.</p>
<p>The <a href="https://docs.easybuild.io/en/latest/Using_external_modules.html#metadata-for-external-modules">metadata</a>
for external modules can be supplied through one or more metadata files, pointed to by the <code>--external-modules-metadata</code> 
configuration option (or corresponding environment variable).
These files are expected to be in INI format, with a section per module name 
and key-value assignments specific to that module.</p>
<p>The following keys are 
<a href="https://docs.easybuild.io/en/latest/Using_external_modules.html#supported-metadata-values">supported by EasyBuild</a>:</p>
<ul>
<li>name: software name(s) provided by the module</li>
<li>version: software version(s) provided by the module</li>
<li>prefix: installation prefix of the software provided by the module</li>
</ul>
<p>For instance, the external module version loaded by the dependency <code>cray-fftw</code> can be specified as follows:
<div class="highlight"><pre><span></span><code><span class="k">[cray-fftw]</span><span class="w"></span>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">FFTW</span><span class="w"></span>
<span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">FFTW_DIR/..</span><span class="w"></span>
<span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3.3.8.10</span><span class="w"></span>
</code></pre></div></p>
<p>This will then ensure that EasyBuild knows the equivalent EasyBuild name(s), version(s) and root of the 
software installation for use in easyblocks. It will also create the corresponding <code>$EBROOT*</code> and
<code>$EBVERSION*</code> environment variables in the build environment after loading the external module
so that the module resembles more a regular EasyBuild-generated module and so that these environment
variables can be used, e.g., in options to <code>configure</code> or <code>cmake</code>. </p>
<p>EasyBuild also includes a default metadata file that will be used, but that one can be very much out-of-date.
And if no information for a 
particular module is present in the metadata files, EasyBuild will even try
to extract the information out of certain environment variables that are used by several Cray PE modules.</p>
<p>On LUMI, users in generally don't need to be too concerned about the metadata file as the <code>EasyBuild-user</code> and other 
EasyBuild configuration modules take care of pointing to the right metadata file, which is specific for each version of the
Cray PE and hence each version of the LUMI software stack.</p>
<h3 id="software-specific-easyblocks">Software-specific easyblocks<a class="headerlink" href="#software-specific-easyblocks" title="Permanent link">&para;</a></h3>
<p>EasyBuild comes with a lot of <a href="https://docs.easybuild.io/en/latest/eb_list_easyblocks.html">software-specific easyblocks</a>.
These have only been tested with the common toolchains
in the automated EasyBuild test procedures. As a result, many of those easyblocks will fail with the Cray toolchains
(and with many other custom toolchains). A common problem is that they don't recongnise the compilers as they test 
for the presence of certain modules and hence simply stop with an error message that the compiler is not 
recognised, but there may also be more subtle problems, like explicitly checking for the name of a dependency rather
than for the presence of the corresponding <code>EBROOT</code> and <code>EBVERSION</code> environment variables through the EasyBuild API.
Hence it may fail to recognise external modules that have a different name than the name that EasyBuild uses for
the package.</p>
<p>For this reason we (and CSCS) tend to use the generic easyblocks more often, specifying configuration and build options
by hand in the corresponding easyconfig parameters rather than relying on the logic in an easyblock to set the
parameter for us based on the dependencies that are present. In some cases, the easyblocks are adapted, but this poses
a maintenance problem. Contributing the modified easyblock back to the EasyBuild community is no guarantee that it remains
compatible as the Cray-specific code cannot currently be tested in the automated test procedures due to lack of access to
the Cray PE and lack of suitable easyconfig files to do the tests. However, keeping the code in our own repositories is no
full solution either as the easyblock may need maintenance when a new version of EasyBuild with an updated easyblock
appears.</p>
<h3 id="other-lumi-specific-easybuild-settings">Other LUMI-specific EasyBuild settings<a class="headerlink" href="#other-lumi-specific-easybuild-settings" title="Permanent link">&para;</a></h3>
<p>On LUMI, we do use a slightly customised version of the flat naming scheme but that is mostly because we are not interested
in the categorisation of modules in module classes as this categorisation is too arbitrary. There are simply too many 
modules that could be put in multiple classes, something which is currently not supported. We decided to remove that level
altogether from the module directory tree.</p>
<h2 id="further-reading-and-information">Further reading and information<a class="headerlink" href="#further-reading-and-information" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://lumi-supercomputer.eu/">LUMI web site</a></li>
<li><a href="https://docs.lumi-supercomputer.eu/">LUMI user documentation web site</a></li>
<li>So far most LUMI trainings were done by HPE Cray and their training materials cannot be distributed
    freely, but there is <a href="https://lumi-supercomputer.github.io/LUMI-training-materials/">some additional training material from the LUMI User Support Team</a>.</li>
<li>This EasyBuild training web site also contains:<ul>
<li>A <a href="https://easybuilders.github.io/easybuild-tutorial/2021-lust/">training given to the LUMI User Support Team in the spring and summer of '21</a></li>
<li>A <a href="https://easybuilders.github.io/easybuild-tutorial/2022-CSC_and_LO/">training for CSC and Local Organisations from May 2022</a></li>
</ul>
</li>
<li>LUMI GitHub repositories:<ul>
<li><a href="https://github.com/Lumi-supercomputer/LUMI-SoftwareStack">LUMI-SoftwareStack</a>
    is the repository that contains all our Lmod modules, custom easyblocks and the easyconfigs of software that has 
    already made it into the central stack. Its structure is inspired on that of the 
    <a href="https://github.com/eth-cscs/production">CSCS repository</a>.
    The repository also contains ample technical information on our implementation which can
    also be browsed through the <a href="https://lumi-supercomputer.github.io/LUMI-SoftwareStack/">lumi-supercomputer GitHub pages</a>.</li>
<li><a href="https://github.com/Lumi-supercomputer/LUMI-EasyBuild-contrib">LUMI-EasyBuild-contrib</a> is our main repository
    of easyconfig files for installation in the user space. Many of these may require more testing or support for
    more configurations. Most subdirectories with easyconfig files also contain a <code>README.md</code> file that explains
    the choices we made when implementing the easyconfig file.</li>
</ul>
</li>
<li>Other sites with Cray hardware that also use EasyBuild<ul>
<li><a href="https://github.com/eth-cscs/production">CSCS GitHub repository</a></li>
</ul>
</li>
</ul>
<hr />
<p><a href="../community/"><em>next: The EasyBuild community</em></a> - <a href="../"><em>(back to overview page)</em></a></p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 27, 2022</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../integration_eessi/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Integration of EasyBuild in EESSI" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Integration of EasyBuild in EESSI
            </div>
          </div>
        </a>
      
      
        
        <a href="../community/" class="md-footer__link md-footer__link--next" aria-label="Next: The EasyBuild community" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              The EasyBuild community
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/easy_build" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/c/easybuilders" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://easybuild.readthedocs.io" target="_blank" rel="noopener" title="easybuild.readthedocs.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M448 336V48c0-26.51-21.5-48-48-48H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1 0-11.72-6.607-21.52-16-27.1v-81.36c9.8-9.64 16-22.24 16-36.44zM143.1 128h192c9.7 0 16.9 7.2 16.9 16s-7.2 16-16 16H143.1c-7.9 0-15.1-7.2-15.1-16s7.2-16 15.1-16zm0 64h192c9.7 0 16.9 7.2 16.9 16s-7.2 16-16 16H143.1c-7.9 0-15.1-7.2-15.1-16s7.2-16 15.1-16zM384 448H96c-17.67 0-32-14.33-32-32s14.33-32 32-32h288v64z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["instant"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>